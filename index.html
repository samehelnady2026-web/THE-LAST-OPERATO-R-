<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NINJA NEON PRO - GUEST & CLOUD</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --neon: #00f2ff; --gold: #f1c40f; --cash: #2ecc71; --bg: #050508; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', Tahoma; color: white; touch-action: none; }
        canvas { display: block; }
        .overlay-screen { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .input-box { background: #111; border: 1.5px solid var(--neon); padding: 12px; border-radius: 12px; color: white; width: 260px; margin: 8px; text-align: center; outline: none; }
        .btn { border: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: 0.3s; width: 280px; margin: 5px; }
        .btn-main { background: var(--neon); color: black; }
        .btn-guest { background: #333; color: white; border: 1px solid #555; }
        .shop-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; max-width: 450px; }
        .skin-item { background: #111; border: 2px solid #333; border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; }
        .skin-item.selected { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }
        #hud { position: fixed; top: 10px; width: 100%; display: none; justify-content: center; gap: 8px; z-index: 100; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.8); border: 1px solid var(--neon); padding: 5px 12px; border-radius: 10px; font-size: 11px; }
    </style>
</head>
<body>

    <div id="auth-screen" class="overlay-screen">
        <h1 style="color: var(--neon); text-shadow: 0 0 15px var(--neon);">NINJA NEON PRO</h1>
        <input type="email" id="email" class="input-box" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="tel" id="phone" class="input-box" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
        <button id="login-btn" class="btn btn-main" onclick="handleAuth(false)">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø­Ø§Ø¨ (Online) ğŸ›¡ï¸</button>
        <button class="btn btn-guest" onclick="handleAuth(true)">Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ (Offline/Fast) âš¡</button>
        
        <p style="font-size: 10px; color: #555; margin-top: 20px;">Powered by Gemini, GitHub, Supabase & Orange Cash</p>
    </div>

    <div id="shop-screen" class="overlay-screen" style="display:none;">
        <h2 style="color: var(--neon);">Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„ØªØ¨Ø§Ø¯Ù„ <span id="mode-tag" style="font-size:10px; color:gray;"></span></h2>
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 15px;">
            ğŸ’µ <span id="w-cash">0</span> | ğŸª™ <span id="w-coins">0</span>
        </div>
        <div id="skin-grid" class="shop-grid"></div>
        <button class="btn btn-main" onclick="startGame()">Ø§Ù†Ø·Ù„Ø§Ù‚ ğŸš€</button>
    </div>

    <div id="hud">
        <div class="stat">ğŸŒ€ LVL: <span id="h-lvl">1</span> <span id="h-guest"></span></div>
        <div class="stat">ğŸ’µ <span id="h-cash">0</span></div>
        <div class="stat">ğŸª™ <span id="h-coins">0</span></div>
    </div>

    <canvas id="g"></canvas>

<script>
    const SB_URL = "https://ctnuuvdakmqpbuzhrsos.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0bnV1dmRha21xcGJ1emhyc29zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODczMzIsImV4cCI6MjA4NzE2MzMzMn0.0X_W6fnko1HezciPTISwnNCNxBUwps-QlAwxqIv3NRw";
    const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

    let user = { email:'guest', phone:'', cash:0, coins:0, owned:['ğŸ¥·','ğŸ‘®'], current:'ğŸ¥·', level:1 };
    let isGuestMode = false;

    // [1] Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
    async function handleAuth(guest) {
        isGuestMode = guest;
        const e = document.getElementById('email').value;
        const p = document.getElementById('phone').value;

        if (!isGuestMode) {
            if(!e.includes('@')) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ ØµØ­ÙŠØ­ Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ");
            document.getElementById('login-btn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...";
            try {
                let { data, error } = await supabaseClient.from('players').select('*').eq('email', e).single();
                if (data) user = data; 
                else {
                    user.email = e; user.phone = p;
                    await supabaseClient.from('players').insert([user]);
                }
            } catch (err) {
                alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„! ØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¶ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.");
                isGuestMode = true;
            }
        } else {
            // ÙˆØ¶Ø¹ Ø§Ù„Ø¶ÙŠÙ: ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙ‚Ø·
            const localData = localStorage.getItem('ninjaGuest');
            if(localData) user = JSON.parse(localData);
            document.getElementById('mode-tag').innerText = "(ÙˆØ¶Ø¹ Ø§Ù„Ø¶ÙŠÙ)";
            document.getElementById('h-guest').innerText = "ğŸ‘¤";
        }

        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('shop-screen').style.display = 'flex';
        renderShop();
    }

    async function save() {
        if (isGuestMode) {
            localStorage.setItem('ninjaGuest', JSON.stringify(user));
        } else {
            localStorage.setItem('ninjaUser', JSON.stringify(user));
            await supabaseClient.from('players').upsert(user).eq('email', user.email);
        }
    }

    // Ø¨Ø§Ù‚ÙŠ Ù…Ø­Ø±Ùƒ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù…Ø®ØªØµØ± Ù„Ù„Ø¹Ø±Ø¶)
    function renderShop() {
        document.getElementById('w-cash').innerText = user.cash;
        document.getElementById('w-coins').innerText = user.coins;
        const grid = document.getElementById('skin-grid'); grid.innerHTML = '';
        const SKINS = [{e:'ğŸ¥·'},{e:'ğŸ‘®'},{e:'ğŸ¶'},{e:'ğŸ±'},{e:'ğŸ¼'},{e:'ğŸ¯'},{e:'ğŸ¦“'},{e:'ğŸ¦™'}];
        SKINS.forEach(s => {
            const card = document.createElement('div');
            card.className = `skin-item ${user.current===s.e?'selected':''}`;
            card.innerHTML = `<span style="font-size:30px;">${s.e}</span>`;
            card.onclick = () => { user.current = s.e; save(); renderShop(); };
            grid.appendChild(card);
        });
    }

    let gameActive = false, pX, pY;
    const canvas = document.getElementById('g'), ctx = canvas.getContext('2d');
    function startGame() {
        document.getElementById('shop-screen').style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        pX = canvas.width/2; pY = canvas.height/2;
        gameActive = true; loop();
    }

    function loop() {
        if(!gameActive) return;
        ctx.fillStyle = "#050508"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.font = "50px Arial"; ctx.textAlign = "center";
        ctx.fillText(user.current, pX, pY);
        document.getElementById('h-cash').innerText = user.cash;
        document.getElementById('h-coins').innerText = user.coins;
        document.getElementById('h-lvl').innerText = user.level;
        requestAnimationFrame(loop);
    }
    window.addEventListener('pointermove', e => { pX = e.clientX; pY = e.clientY; });
</script>
</body>
</html>
