<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BLOCKSAM 2026 - ULTIMATE</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
    <style>
        :root {
            --bg: #050505; --primary: #00f2ff; --accent: #ffd700; --danger: #ff4b2b; --glass: rgba(255,255,255,0.1);
        }
        body, html { margin:0; padding:0; width:100%; height:100%; background:var(--bg); color:#fff; font-family:sans-serif; overflow:hidden; touch-action:none; }
        
        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª */
        .screen { position:fixed; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; background:var(--bg); z-index:1000; transition:0.3s; }
        .card { width:90%; max-width:380px; text-align:center; background:var(--glass); padding:25px; border-radius:25px; border:1px solid #333; backdrop-filter: blur(10px); }
        
        .btn { padding:12px; border:none; border-radius:12px; font-weight:bold; cursor:pointer; margin:5px; transition:0.2s; }
        .btn-main { background:var(--primary); color:#000; width:100%; }
        .btn-shop { background:var(--accent); color:#000; font-size:12px; }

        /* HUD */
        #hud { position:fixed; top:0; width:100%; display:none; justify-content:space-between; align-items:center; padding:10px 15px; z-index:2000; box-sizing:border-box; background:rgba(0,0,0,0.5); }
        .stat-group { display:flex; gap:10px; }
        .pill { background:#000; padding:5px 12px; border-radius:15px; border:1px solid #444; font-size:13px; font-weight:bold; }

        /* Ø§Ù„Ù…ØªØ¬Ø± */
        #shop-ui { display:none; z-index:3000; background:rgba(0,0,0,0.9); }
        .shop-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin:15px 0; max-height:300px; overflow-y:auto; }
        .item-box { background:var(--glass); padding:10px; border-radius:15px; border:1px solid #444; cursor:pointer; font-size:11px; }
        .item-box:active { transform:scale(0.95); }

        canvas { display:block; }
    </style>
</head>
<body>

    <div id="auth-screen" class="screen">
        <div class="card">
            <h1 style="color:var(--primary); letter-spacing:4px;">BLOCKSAM</h1>
            <div id="auth-inputs">
                <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:none; background:#111; color:#fff;">
                <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:none; background:#111; color:#fff;">
                <button class="btn btn-main" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
            </div>
            <button class="btn btn-main" style="background:#444; color:#fff; margin-top:10px;" onclick="guestLogin()">Ø¯Ø®ÙˆÙ„ ÙƒØ¶ÙŠÙ ğŸ‘¤</button>
            <p style="font-size:12px; color:#666; cursor:pointer;" onclick="isReg=!isReg; this.innerText=isReg?'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø¯Ø®ÙˆÙ„':'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„'">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„</p>
        </div>
    </div>

    <div id="hud">
        <div class="stat-group">
            <div class="pill" style="color:var(--accent)">ğŸª™ <span id="h-coins">0</span></div>
            <div class="pill" style="color:#4cd137">ğŸ’µ <span id="h-cash">0</span></div>
        </div>
        <div class="stat-group">
            <button class="btn btn-shop" onclick="toggleShop(true)">ğŸ›’ Ø§Ù„Ø³ÙˆÙ‚</button>
            <button class="btn" style="background:#ff4b2b; color:#fff; padding:5px 10px;" onclick="location.reload()">II</button>
        </div>
    </div>

    <div id="shop-ui" class="screen">
        <div class="card" style="max-width:400px;">
            <h2 style="margin:0 0 15px 0;">Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±</h2>
            <div class="shop-grid">
                <div class="item-box" onclick="buyItem('laser', 500)">ğŸ”« Ù„ÙŠØ²Ø±<br>500ğŸª™</div>
                <div class="item-box" onclick="buyItem('bomb', 1500)">ğŸ’£ Ù‚Ù†Ø§Ø¨Ù„<br>1500ğŸª™</div>
                <div class="item-box" onclick="setSkin('ğŸ¤–')">ğŸ¤– Ø¢Ù„ÙŠ<br>Ù…Ø¬Ø§Ù†Ù‹Ø§</div>
                <div class="item-box" onclick="setSkin('ğŸ‰')">ğŸ‰ ØªÙ†ÙŠÙ†<br>1000ğŸª™</div>
                <div class="item-box" style="border-color:var(--accent)" onclick="exchange()">ğŸ”„ ØµØ±Ù<br>1000ğŸª™=10ğŸ’µ</div>
            </div>
            <button class="btn btn-main" onclick="toggleShop(false)">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³ÙˆÙ‚</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const { Client, Account, Databases, ID } = Appwrite;
    const client = new Client().setEndpoint('https://fra.cloud.appwrite.io/v1').setProject('69943f560019334ae3b5');
    const account = new Account(client);
    const db = new Databases(client);
    const DB_ID = '69943bf8001373c3c286', COL_ID = 'players';

    let isReg = false;
    let state = { uid: null, coins: 0, cash: 0, level: 1, skin: 'ğŸ¥·', weapon: 'none' };
    let gameActive = false, portalActive = false;
    let entities = [];
    let bgColors = ['#050505', '#0a1624', '#1a0a24', '#0a2411'];

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
    async function handleLogin() {
        const e = document.getElementById('email').value, p = document.getElementById('password').value;
        try {
            if(isReg) await account.create(ID.unique(), e, p);
            await account.createEmailSession(e, p);
            const u = await account.get(); state.uid = u.$id;
            loadData();
        } catch(err) { alert(err.message); }
    }

    function guestLogin() {
        state.uid = "guest_" + Date.now();
        const local = localStorage.getItem('blocksam_save');
        if(local) state = JSON.parse(local);
        startGame();
    }

    async function loadData() {
        try {
            const data = await db.getDocument(DB_ID, COL_ID, state.uid);
            state.coins = data.coins; state.cash = data.cash;
        } catch(e) { /* Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯ */ }
        startGame();
    }

    // --- Ø§Ù„Ù…ØªØ¬Ø± ---
    function toggleShop(show) { document.getElementById('shop-ui').style.display = show ? 'flex' : 'none'; }
    
    function buyItem(type, price) {
        if(state.coins >= price) {
            state.coins -= price; state.weapon = type; alert("ØªÙ… Ø´Ø±Ø§Ø¡ Ø§Ù„Ø³Ù„Ø§Ø­!");
            updateUI();
        } else alert("Ø§Ù„ÙƒÙˆÙŠÙ† ØºÙŠØ± ÙƒØ§ÙÙ");
    }

    function setSkin(s) { state.skin = s; updateUI(); }

    function exchange() {
        if(state.coins >= 1000) {
            state.coins -= 1000; state.cash += 10; updateUI();
        } else alert("ØªØ­ØªØ§Ø¬ 1000 ÙƒÙˆÙŠÙ†!");
    }

    // --- Ø§Ù„Ù…Ø­Ø±Ùƒ ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let pX, pY;

    function startGame() {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        pX = canvas.width/2; pY = canvas.height/2;
        gameActive = true;
        loop();
    }

    function spawn() {
        const rand = Math.random();
        let type = 'monster';
        if(rand > 0.4) type = 'coin';
        if(rand > 0.9) type = 'cash';
        
        entities.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            type: type,
            size: type === 'monster' ? 30 : 20
        });
    }

    function updateUI() {
        document.getElementById('h-coins').innerText = state.coins;
        document.getElementById('h-cash').innerText = state.cash;
        localStorage.setItem('blocksam_save', JSON.stringify(state));
    }

    function loop() {
        if(!gameActive) return;
        ctx.fillStyle = bgColors[(state.level-1) % bgColors.length];
        ctx.fillRect(0,0,canvas.width, canvas.height);

        if(Math.random() < 0.03) spawn();

        // Ø±Ø³Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©
        if(state.coins >= 1000 && !portalActive) portalActive = true;
        if(portalActive) {
            ctx.font = "60px Arial";
            ctx.fillText("ğŸŒ€", canvas.width/2, canvas.height/2);
            if(Math.hypot(pX - canvas.width/2, pY - canvas.height/2) < 40) {
                state.level++; state.coins = 0; portalActive = false; entities = [];
                updateUI();
            }
        }

        entities.forEach((ent, i) => {
            ctx.font = ent.size + "px Arial";
            let icon = ent.type === 'coin' ? 'ğŸª™' : (ent.type === 'cash' ? 'ğŸ’µ' : 'ğŸ‘¾');
            ctx.fillText(icon, ent.x, ent.y);

            // ØªØµØ§Ø¯Ù…
            if(Math.hypot(pX - ent.x, pY - ent.y) < 30) {
                if(ent.type === 'coin') state.coins += 10;
                else if(ent.type === 'cash') state.cash += 1;
                else { state.coins = Math.max(0, state.coins - 50); }
                entities.splice(i, 1);
                updateUI();
            }
        });

        // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ø³Ù„Ø§Ø­
        ctx.font = "50px Arial";
        ctx.fillText(state.skin, pX, pY);
        if(state.weapon !== 'none') {
            ctx.font = "20px Arial";
            ctx.fillText(state.weapon === 'laser' ? 'ğŸ”«' : 'ğŸ’£', pX + 30, pY - 30);
        }

        requestAnimationFrame(loop);
    }

    canvas.addEventListener('touchmove', e => {
        pX = e.touches[0].clientX; pY = e.touches[0].clientY;
        e.preventDefault();
    }, {passive:false});

    // ØªØ´ØºÙŠÙ„
    document.addEventListener('DOMContentLoaded', () => {
        const local = localStorage.getItem('blocksam_save');
        if(local) {
            state = JSON.parse(local);
            document.getElementById('auth-inputs').innerHTML += `<button class="btn btn-main" style="background:var(--accent); color:#000;" onclick="startGame()">Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙƒÙ€ ${state.uid.substring(0,5)}</button>`;
        }
    });

</script>
</body>
                                                                                        </html>
